{"version":3,"sources":["javascript/namespace-scanner.ts"],"names":[],"mappings":"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","file":"namespace-scanner.js","sourcesContent":["/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport * as estree from 'estree';\n\nimport {Warning} from '../model/model';\n\nimport {getIdentifierName, getNamespacedIdentifier} from './ast-value';\nimport {Visitor} from './estree-visitor';\nimport * as esutil from './esutil';\nimport {JavaScriptDocument} from './javascript-document';\nimport {JavaScriptScanner} from './javascript-scanner';\nimport * as jsdoc from './jsdoc';\nimport {ScannedNamespace} from './namespace';\n\nexport class NamespaceScanner implements JavaScriptScanner {\n  async scan(\n      document: JavaScriptDocument,\n      visit: (visitor: Visitor) => Promise<void>) {\n    const visitor = new NamespaceVisitor(document);\n    await visit(visitor);\n    return {\n      features: Array.from(visitor.namespaces),\n      warnings: visitor.warnings\n    };\n  }\n}\n\nclass NamespaceVisitor implements Visitor {\n  namespaces = new Set<ScannedNamespace>();\n  document: JavaScriptDocument;\n  warnings: Warning[] = [];\n\n  constructor(document: JavaScriptDocument) {\n    this.document = document;\n  }\n\n  /**\n   * Look for object declarations with @namespace in the docs.\n   */\n  enterVariableDeclaration(\n      node: estree.VariableDeclaration, _parent: estree.Node) {\n    if (node.declarations.length !== 1) {\n      return;  // Ambiguous.\n    }\n    this._initNamespace(node, node.declarations[0].id);\n  }\n\n  /**\n   * Look for object assignments with @namespace in the docs.\n   */\n  enterAssignmentExpression(\n      node: estree.AssignmentExpression, parent: estree.Node) {\n    this._initNamespace(parent, node.left);\n  }\n\n  enterProperty(node: estree.Property, _parent: estree.Node) {\n    this._initNamespace(node, node.key);\n  }\n\n  private _initNamespace(node: estree.Node, nameNode: estree.Node) {\n    const comment = esutil.getAttachedComment(node);\n    // Quickly filter down to potential candidates.\n    if (!comment || comment.indexOf('@namespace') === -1) {\n      return;\n    }\n    const analyzedName = getIdentifierName(nameNode);\n\n    const docs = jsdoc.parseJsdoc(comment);\n    const namespaceTag = jsdoc.getTag(docs, 'namespace');\n    const explicitName = namespaceTag && namespaceTag.name;\n    let namespaceName;\n    if (explicitName) {\n      namespaceName = explicitName;\n    } else if (analyzedName) {\n      namespaceName = getNamespacedIdentifier(analyzedName, docs);\n    } else {\n      // TODO(fks): Propagate a warning if name could not be determined\n      return;\n    }\n\n    const sourceRange = this.document.sourceRangeForNode(node);\n    if (!sourceRange) {\n      throw new Error(\n          `Unable to determine sourceRange for @namespace: ${comment}`);\n    }\n\n    const summaryTag = jsdoc.getTag(docs, 'summary');\n    const summary = (summaryTag && summaryTag.description) || '';\n    const description = docs.description;\n\n    this.namespaces.add(new ScannedNamespace(\n        namespaceName, description, summary, node, docs, sourceRange));\n  }\n}\n"]}