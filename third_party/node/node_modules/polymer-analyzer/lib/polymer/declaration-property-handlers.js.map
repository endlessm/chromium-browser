{"version":3,"sources":["polymer/declaration-property-handlers.ts"],"names":[],"mappings":"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","file":"declaration-property-handlers.js","sourcesContent":["/**\n * @license\n * Copyright (c) 2015 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport * as estree from 'estree';\n\nimport * as astValue from '../javascript/ast-value';\nimport {JavaScriptDocument} from '../javascript/javascript-document';\nimport {Severity, Warning} from '../model/model';\nimport {ScannedBehaviorAssignment} from '../polymer/behavior';\n\nimport {analyzeProperties} from './analyze-properties';\nimport {parseExpressionInJsStringLiteral} from './expression-scanner';\nimport {Observer, ScannedPolymerElement} from './polymer-element';\n\nexport type BehaviorAssignmentOrWarning = {\n  kind: 'warning',\n  warning: Warning\n} | {kind: 'behaviorAssignment', assignment: ScannedBehaviorAssignment};\n\nexport function getBehaviorAssignmentOrWarning(\n    argNode: estree.Node,\n    document: JavaScriptDocument): BehaviorAssignmentOrWarning {\n  const behaviorName = astValue.getIdentifierName(argNode);\n  if (!behaviorName) {\n    return {\n      kind: 'warning',\n      warning: new Warning({\n        code: 'could-not-determine-behavior-name',\n        message: `Could not determine behavior name from expression of type ` +\n            `${argNode.type}`,\n        severity: Severity.WARNING,\n        sourceRange: document.sourceRangeForNode(argNode)!,\n        parsedDocument: document\n      })\n    };\n  }\n  return {\n    kind: 'behaviorAssignment',\n    assignment: {\n      name: behaviorName,\n      sourceRange: document.sourceRangeForNode(argNode)!\n    }\n  };\n}\n\nexport type PropertyHandlers = {\n  [key: string]: (node: estree.Node) => void\n};\n\n\n/**\n * Returns an object containing functions that will annotate `declaration` with\n * the polymer-specific meaning of the value nodes for the named properties.\n */\nexport function declarationPropertyHandlers(\n    declaration: ScannedPolymerElement,\n    document: JavaScriptDocument): PropertyHandlers {\n  return {\n    is(node: estree.Node) {\n      if (node.type === 'Literal') {\n        declaration.tagName = '' + node.value;\n      }\n    },\n    properties(node: estree.Node) {\n      for (const prop of analyzeProperties(node, document)) {\n        declaration.addProperty(prop);\n      }\n    },\n    behaviors(node: estree.Node) {\n      if (node.type !== 'ArrayExpression') {\n        return;\n      }\n      for (const element of node.elements) {\n        const result = getBehaviorAssignmentOrWarning(element, document);\n        if (result.kind === 'warning') {\n          declaration.warnings.push(result.warning);\n        } else {\n          declaration.behaviorAssignments.push(result.assignment);\n        }\n      }\n    },\n    observers(node: estree.Node) {\n      const observers = extractObservers(node, document);\n      if (!observers) {\n        return;\n      }\n      declaration.warnings = declaration.warnings.concat(observers.warnings);\n      declaration.observers = declaration.observers.concat(observers.observers);\n    },\n    listeners(node: estree.Node) {\n\n      if (node.type !== 'ObjectExpression') {\n        declaration.warnings.push(new Warning({\n          code: 'invalid-listeners-declaration',\n          message: '`listeners` property should be an object expression',\n          severity: Severity.WARNING,\n          sourceRange: document.sourceRangeForNode(node)!,\n          parsedDocument: document\n        }));\n        return;\n      }\n\n      for (const p of node.properties) {\n        const evtName = p.key.type === 'Literal' && p.key.value ||\n            p.key.type === 'Identifier' && p.key.name;\n        const handler = p.value.type !== 'Literal' || p.value.value;\n\n        if (typeof evtName !== 'string' || typeof handler !== 'string') {\n          // TODO (maklesoft): Notifiy the user somehow that a listener entry\n          // was not extracted\n          // because the event or handler namecould not be statically analyzed.\n          // E.g. add a low-severity\n          // warning once opting out of rules is supported.\n          continue;\n        }\n\n        declaration.listeners.push({event: evtName, handler: handler});\n      }\n    }\n  };\n}\n\n\nexport function extractObservers(\n    observersArray: estree.Node, document: JavaScriptDocument): undefined|\n    {observers: Observer[], warnings: Warning[]} {\n  if (observersArray.type !== 'ArrayExpression') {\n    return;\n  }\n  let warnings: Warning[] = [];\n  const observers = [];\n  for (const element of observersArray.elements) {\n    let v = astValue.expressionToValue(element);\n    if (v === undefined) {\n      v = astValue.CANT_CONVERT;\n    }\n    const parseResult =\n        parseExpressionInJsStringLiteral(document, element, 'callExpression');\n    warnings = warnings.concat(parseResult.warnings);\n    observers.push({\n      javascriptNode: element,\n      expression: v,\n      parsedExpression: parseResult.databinding\n    });\n  }\n  return {observers, warnings};\n}\n"]}