{"version":3,"sources":["html/html-element-reference-scanner.ts"],"names":[],"mappings":";AAAA;;;;;;;;;;;;GAYG;;;;;;;;;;AAEH,6BAA6B;AAC7B,mCAA6C;AAC7C,kEAAmE;AAInE,MAAM,eAAe,GAAG,IAAI,CAAC,UAAU,CAAC,kBAAkB,CAAC,UAAU,CAAC,CAAC;AAEvE;;;;;GAKG;AACH;IACE,OAAO,CAAC,IAAa;QACnB,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC;IAChB,CAAC;IAEK,IAAI,CACN,QAA4B,EAC5B,KAA8C;;YAChD,MAAM,QAAQ,GAA8B,EAAE,CAAC;YAE/C,MAAM,OAAO,GAAG,CAAC,IAAa;gBAC5B,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;oBACvC,MAAM,OAAO,GAAG,IAAI,2CAAuB,CACvC,IAAI,CAAC,OAAO,EAAE,QAAQ,CAAC,kBAAkB,CAAC,IAAI,CAAE,EAAE,IAAI,CAAC,CAAC;oBAE5D,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;wBACf,GAAG,CAAC,CAAC,MAAM,IAAI,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;4BAC9B,OAAO,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE;gCAChC,IAAI,EAAE,IAAI,CAAC,IAAI;gCACf,KAAK,EAAE,IAAI,CAAC,KAAK;gCACjB,WAAW,EAAE,QAAQ,CAAC,uBAAuB,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAE;gCAC/D,eAAe,EACX,QAAQ,CAAC,2BAA2B,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAE;gCAC1D,gBAAgB,EACZ,QAAQ,CAAC,4BAA4B,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC;6BAC3D,CAAC,CAAC;wBACL,CAAC;oBACH,CAAC;oBAED,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;gBACzB,CAAC;gBAED,0BAA0B;gBAC1B,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,KAAK,UAAU,CAAC,CAAC,CAAC;oBAChC,MAAM,OAAO,GAAG,qBAAY,CAAC,OAAO,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC;oBAC9D,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;wBACZ,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC,CAAC;4BACvB,OAAO,CAAC,CAAC,CAAC,CAAC;4BACX,MAAM,CAAC,KAAK,CAAC;wBACf,CAAC,CAAC,CAAC;oBACL,CAAC;gBACH,CAAC;YACH,CAAC,CAAC;YAEF,MAAM,KAAK,CAAC,OAAO,CAAC,CAAC;YAErB,MAAM,CAAC,EAAC,QAAQ,EAAE,QAAQ,EAAC,CAAC;QAC9B,CAAC;KAAA;CACF;AAhDD,kEAgDC;AAED;;;;GAIG;AACH,uCAA+C,SAC3C,2BAA2B;IAC7B,OAAO,CAAC,IAAa;QACnB,MAAM,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,QAAQ,KAAK,YAAY,CAAC;IACjE,CAAC;CACF;AALD,8EAKC","file":"html-element-reference-scanner.js","sourcesContent":["/**\n * @license\n * Copyright (c) 2016 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport * as dom5 from 'dom5';\nimport {ASTNode, treeAdapters} from 'parse5';\nimport {ScannedElementReference} from '../model/element-reference';\nimport {HtmlVisitor, ParsedHtmlDocument} from './html-document';\nimport {HtmlScanner} from './html-scanner';\n\nconst isCustomElement = dom5.predicates.hasMatchingTagName(/(.+-)+.+/);\n\n/**\n * Scans for HTML element references/uses in a given document.\n * All elements will be detected, including anything in <head>.\n * This scanner will not be loaded by default, but the custom\n * element extension of it will be.\n */\nexport class HtmlElementReferenceScanner implements HtmlScanner {\n  matches(node: ASTNode): boolean {\n    return !!node;\n  }\n\n  async scan(\n      document: ParsedHtmlDocument,\n      visit: (visitor: HtmlVisitor) => Promise<void>) {\n    const elements: ScannedElementReference[] = [];\n\n    const visitor = (node: ASTNode) => {\n      if (node.tagName && this.matches(node)) {\n        const element = new ScannedElementReference(\n            node.tagName, document.sourceRangeForNode(node)!, node);\n\n        if (node.attrs) {\n          for (const attr of node.attrs) {\n            element.attributes.set(attr.name, {\n              name: attr.name,\n              value: attr.value,\n              sourceRange: document.sourceRangeForAttribute(node, attr.name)!,\n              nameSourceRange:\n                  document.sourceRangeForAttributeName(node, attr.name)!,\n              valueSourceRange:\n                  document.sourceRangeForAttributeValue(node, attr.name)\n            });\n          }\n        }\n\n        elements.push(element);\n      }\n\n      // Descend into templates.\n      if (node.tagName === 'template') {\n        const content = treeAdapters.default.getTemplateContent(node);\n        if (content) {\n          dom5.nodeWalk(content, (n) => {\n            visitor(n);\n            return false;\n          });\n        }\n      }\n    };\n\n    await visit(visitor);\n\n    return {features: elements};\n  }\n}\n\n/**\n * Scans for custom element references/uses.\n * All custom elements will be detected except <dom-module>.\n * This is a default scanner.\n */\nexport class HtmlCustomElementReferenceScanner extends\n    HtmlElementReferenceScanner {\n  matches(node: ASTNode): boolean {\n    return isCustomElement(node) && node.nodeName !== 'dom-module';\n  }\n}\n"]}